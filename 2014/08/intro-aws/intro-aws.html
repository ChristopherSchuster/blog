<p> Amazon Web Services (AWS) is a collection of remote computing services (also called web services) that together make up a cloud computing platform, offered over the Internet by Amazon.com. Because AWS is huge and complex, is not possible cover all the topics on an simple post, so we will cover here the basis of
the  two most central and well-known o services that are Amazon EC2 and Amazon S3.
</p>

<h2> Open a free account</h2>
<p>
    This post assumes that you have an amazon account. If you don't have one, you can create one for free  with the instructions
    on the video  <a  href="http://aws.amazon.com/getting-started/"> Create an AWS account </a>
</p>

<h2>Getting your access key ID and secret access key</h2>
<p>
Is not a good practice use you account keys to access you resources because this key has access to your bills information, unlimited resources, etc.
Is better create another user with limited access with diferent keys.  The article 
<a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/IAMBestPractices.html"> IAM Best Practices </a> contains a list of recommended practices to
avoid security issues with your keys.
</p>

<h3> Create  individual IAM users</h3>

<p>
    Inside your dashboard go to users options click <strong> Create new users </strong> button , write the username and click. AWS will
    create a new AIM user with a new keypair. Click download keys and store on a secure location.

</p>

<h2> Installing and configuring AWS Command Line Interface </h2>
<p>
    AWS is a command line interface written in python that is used to send commands and get information from AWS. As any standard package from
    python can be installed via pip:
</p>

<pre>
  pip install awscli
</pre>

<p>You can test if the installation was successfull executing the next command: </p>

<pre>
    aws help
</pre>


<h3> Configuring the AWS Command Line Interface </h3>

<p>You can setup the environment variables â€“ AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY or you can run awscli configure:
</p>

<pre>
    $aws configure

    AWS Access Key ID [None]: IGMAOKYKYYLNEDIEYDF
    AWS Secret Access Key [None]: ASDA=JSADFJJJ;Jj;kdfu=asdf
    Default region name [None]: us-west-1
    Default output format [None]: json
</pre>



<h2> Amazon Elastic Compute Cloud EC2 </h2>
<p>
  (EC2) provides scalable virtual private servers using Xen. The user can create by demand one or many virtual servers that can be 
  deleted by demand as well. Resources for an instance such as disk, network interfaces, cpu, memory can be changed at any moment
  so it is possible scale an application at low cost. All the physical and infraestructure is run by Amazon, so as user you don't 
  have to take care of aspects as physical security, maintenance, etc.
</p>
<p>
    The command  <code>aws  ec2 help </code> show you all the options that you have to manage ec2 instances.
</p>

<h3> Listing EC2 Regions </h3>

<pre>
  $ aws ec2 describe-regions


    {
        "Regions": [
            {
                "Endpoint": "ec2.eu-west-1.amazonaws.com", 
                "RegionName": "eu-west-1"
            }, 
            {
                "Endpoint": "ec2.sa-east-1.amazonaws.com", 
                "RegionName": "sa-east-1"
            }, 
            {
                "Endpoint": "ec2.us-east-1.amazonaws.com", 
                "RegionName": "us-east-1"
            }, 
            {
                "Endpoint": "ec2.ap-northeast-1.amazonaws.com", 
                "RegionName": "ap-northeast-1"
            }, 
            {
                "Endpoint": "ec2.us-west-2.amazonaws.com", 
                "RegionName": "us-west-2"
            }, 
            {
                "Endpoint": "ec2.us-west-1.amazonaws.com", 
                "RegionName": "us-west-1"
            }, 
            {
                "Endpoint": "ec2.ap-southeast-1.amazonaws.com", 
                "RegionName": "ap-southeast-1"
            }, 
            {
                "Endpoint": "ec2.ap-southeast-2.amazonaws.com", 
                "RegionName": "ap-southeast-2"
            }
        ]
    }  
</pre>


<h3> Security Groups</h3>

<p>
    A security group acts like a virtual Firewall that control access to one or more instances, you can define custom rules to
    manage traffic associated to every instance and associate one or more users to one or more security groups. 
</p>

<h4> Listing Security Groups </h4>

<p>
You can use the command <code>aws ec2 describe-security-groups </code> to get a list of your security groups:
</p>

<pre>

  $ aws ec2 describe-security-groups
    {
        "SecurityGroups": [
            {
                "IpPermissionsEgress": [
                    {
                        "IpProtocol": "-1", 
                        "IpRanges": [
                            {
                                "CidrIp": "0.0.0.0/0"
                            }
                        ], 
                        "UserIdGroupPairs": []
                    }
                ], 
                "Description": "default VPC security group", 
                "IpPermissions": [
                    {
                        "IpProtocol": "-1", 
                        "IpRanges": [], 
                        "UserIdGroupPairs": [
                            {
                                "UserId": "495087967", 
                                "GroupId": "sg-85u5mch"
                            }
                        ]
                    }
                ], 
                "GroupName": "default", 
                "VpcId": "vpc-34985c", 
                "OwnerId": "098765454", 
                "GroupId": "sg-adfa3545"
            }
        ]
    }  


</pre>

<h4> Creating Security Groups </h4>
<p>
    We wil create a security group named <em> security_test</em> to do that we use the command <code> aws ec2 create-security-group</code>
</p>


<pre>
    $ aws ec2 create-security-group --group-nam "security_test" --description "Security test for blog"

    {
        "return": "true", 
        "GroupId": "sg-fdasd"
    }
</pre>

<h4> Giving ssh access to groups</h4>
<p>
We will want to access ec2 instances via ssh, to do that, we must add ssh access to the security group associated with an instance.
We can use the command <code> aws ec2 authorize-security-group-ingress </code>
</p>

<pre>
     $aws ec2 authorize-security-group-ingress --group-name security_test --protocol tcp --port 22 --cidr 0.0.0.0/0

  {
    "return": "true"
  }

</pre>

<p>
    <strong> Note:</strong> 0.0.0.0/0  address is ok for short time testing porposal but unnaceptable for production.
</p>


<h3>SSH keypair </h3>
<p>
    In order to access ec2 instances a ssh keypair is required, you can create one using the command <code>  aws ec2 create-key-pair</code>
</p>

<pre>
    $aws ec2 create-key-pair --key-name manuel_dev_key --query 'KeyMaterial' --output text > manuel_key.pem

</pre>

<h3> Amazon Machine Images (AMIs) </h3>

<p>
    An AMI is a template that contains a software configuration (Operative System, Applications, etc.). From an AIM you can create
    an instance wich is a running copy of this template. From one AMI can be created one or more Instances.
</p>


<h4>Amazon Linux AMIs </h4>

<p>
    Amazon Linux is Linux flavor pretty similar to Red Hat/ CentOs with the advantange that is developed and maintained by Amazon, so
    if you choose one of this AMI you will get for free:
</p>

<ul>
    <li> Security updates relased by Amazon</li>
    <li> Drivers tunned for optimal performance inside Amazon enviroment</li>
    <li> AWS support </li>
</ul>

<p>
We will choose for this post an AMI <strong> ami-a8d3d4ed </strong> which is available only for  us-west-1  region . Here a link where you can find a 
 list of <a href="http://aws.amazon.com/amazon-linux-ami/"> Amazon Linux AMIs for every region </a>.

</p>
<p>
    You can see the amil list using the <code>   aws ec2 describe-images   </code> command:
</p>

<pre>
  $aws ec2 describe-images --image-ids '["ami-a8d3d4ed"]'
    {
        "Images": [
            {
                "VirtualizationType": "paravirtual", 
                "Name": "amzn-ami-pv-2014.03.2.x86_64-ebs", 
                "Hypervisor": "xen", 
                "ImageOwnerAlias": "amazon", 
                "ImageId": "ami-a8d3d4ed", 
                "RootDeviceType": "ebs", 
                "State": "available", 
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sda1", 
                        "Ebs": {
                            "DeleteOnTermination": true, 
                            "SnapshotId": "snap-d6bea21a", 
                            "VolumeSize": 8, 
                            "VolumeType": "standard", 
                            "Encrypted": false
                        }
                    }
                ], 
                "Architecture": "x86_64", 
                "ImageLocation": "amazon/amzn-ami-pv-2014.03.2.x86_64-ebs", 
                "KernelId": "aki-880531cd", 
                "OwnerId": "137112412989", 
                "RootDeviceName": "/dev/sda1", 
                "Public": true, 
                "ImageType": "machine", 
                "Description": "Amazon Linux AMI x86_64 PV EBS"
            }
        ]
    }  


</pre>


<h3>Listing EC2 Instances <h3>
<p>
    We can query the list of instances for account/user usign the next command:
</p>

<pre>
    $aws ec2 describe-instances

    {
        "Reservations": []
    }  
</pre>

<p>
   <strong> Note:</strong> Because we haven't create any instance yet, the returned list is empty.
</p>


<h3> Runing EC2 Instances</h3>

<p>
    The command <code> aws ec2 run-instances </code> has a lot of parameters that won't be covered on this post. To run an instance you
    will need some basic params:
</p>

<pre>
  $aws ec2 run-instances --image-id ami-a8d3d4ed --instance-type t1.micro --key-name manuel_dev_key --security-groups security_test 
</pre>

<h3> Connecting to EC2 instances via ssh </h3>

<p>
    Run the command  <code> aws ec2 describe-instance </code> check the public url for your isntace in the value  PublicDnsName . Now you
    can use ssh with your key and the ec2-user
</p>

<pre>
  ssh -i ./manuel_key.pem ec2-user@ec2-856-3632-56665-fdad.us-west-1.compute.amazonaws.com  

    Last login: Sat Aug 30 16:15:27 2014 from xx.xxx

       __|  __|_  )
       _|  (     /   Amazon Linux AMI
      ___|\___|___|

</pre>


<h3> Terminanting an instance  </h3>

<p> Use the command <code>aws ec2 terminate-instances   </code>  passing the instance id as a param</p>

<pre>

  $ aws ec2 terminate-instances --instance-ids i-3f522861
 
    {
        "TerminatingInstances": [
            {
                "InstanceId": "i-3f522861", 
                "CurrentState": {
                    "Code": 32, 
                    "Name": "shutting-down"
                }, 
                "PreviousState": {
                    "Code": 16, 
                    "Name": "running"
                }
            }
        ]
    }  

</pre>


<h2>References </h2>

<ul>
    <li>
         <a href="https://en.wikipedia.org/wiki/Amazon_Web_Services">Wikipedia</a>
    </li>
    <li>
        <a href="http://docs.aws.amazon.com/gettingstarted/latest/awsgsg-intro/gsg-aws-intro.html"> Getting Started with AWS</a>
    </li>
    <li>
        <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/concepts.html"> EC2  User Guide</a>
    </li>
    <li>
        <a href="http://aws.amazon.com/amazon-linux-ami/"> Amazon Linux AMIs </a>
    </li>
    <li>
        <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-network-security.html"> Amazon Security Groups</a>
    </li>
    <li>
        <a href="http://docs.aws.amazon.com/cli/latest/userguide/cli-ec2-keypairs.html"> Using Key Pairs </a>
    </li>

</ul>
