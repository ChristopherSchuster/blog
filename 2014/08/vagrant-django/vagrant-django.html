<p>
    <a href="http://www.vagrantup.com/"> Vagrant </a> is an open source tool for virtual development enviroments. In this guide we will
    create an Ubuntu Virtual machine for django development that will be provisioned with <a href="http://www.maigfrga.ntweb.co/introduccion-chef-server/"> chef</a>
</p>

<h3> VirtualBox Instalation</h3>
<p>
    Prefered virtualization system for vagrant is VirtualBox. It works with another virtualizations tools, you can refer oficial documentation for more
    information. If you don't have already Virtualbox installed at your local box you can install the package using your package manager:
</p>

<pre>
    $sudo apt-get install virtualbox
</pre>

<h3> Installing Vagrant </h3>
<p>My sugestion is not install from package manager, vagrant is a tool that release new version very quickly and always is better get the last version
    for the oficial website. So go to <a href="http://www.vagrantup.com/downloads.html"> http://www.vagrantup.com/downloads.html </a>. Choose the version
    for your system, download it and install it, in my case, i use ubuntu 64 bits:
</p>
<pre>
  $sudo dpkg -i vagrant_1.6.3_x86_64.deb  
</pre>

<h3> Adding a box </h3>

<p>
    Before create an enviroment you need install in your local machine a vagrant box.
    You can browse <a href="https://vagrantcloud.com/"> Vagrant's Cloud website </a> to find more boxes. For this
    post we will use an Ubuntu box:
</p>

<pre>
    $ vagrant box add hashicorp/precise64

    Vagrant is upgrading some internal state for the latest version.
    Please do not quit Vagrant at this time. While upgrading, Vagrant
    will need to copy all your boxes, so it will use a considerable
    amount of disk space. After it is done upgrading, the temporary disk
    space will be freed.

    Press ctrl-c now to exit if you want to remove some boxes or free
    up some disk space.

    Press any other key to continue.
    ==> box: Loading metadata for box 'hashicorp/precise64'
        box: URL: https://vagrantcloud.com/hashicorp/precise64
    This box can work with multiple providers! The providers that it
    can work with are listed below. Please review the list and choose
    the provider you will be working with.

    1) hyperv
    2) virtualbox
    3) vmware_fusion
    Enter your choice: 2
    ==> box: Adding box 'hashicorp/precise64' (v1.1.0) for provider: virtualbox
        box: Downloading: https://vagrantcloud.com/hashicorp/precise64/version/2/provider/virtualbox.box
    ==> box: Successfully added box 'hashicorp/precise64' (v1.1.0) for 'virtualbox'!
</pre>


<h3>Create an Ubuntu box Development Environment </h3>
<p>
    You can create a new box in seconds with the command <code> vagrant init</code> and then tell vagrant what kind of 
    box do you want.
</p>
<pre>
    $vagrant init

    A `Vagrantfile` has been placed in this directory. You are now    
    ready to `vagrant up` your first virtual environment! Please read
    the comments in the Vagrantfile as well as documentation on
    `vagrantup.com` for more information on using Vagrant.
</pre>

<p>This commands creats a file named Vagrantfile. We should edit this file in order to setup our virtualbox according of our needs, so the first

step is tell vagrant that we want and ubuntu box editing this file, find the option  config.vm.box  and editing according the box you want:

</p>

<pre>
    config.vm.box = "hashicorp/precise64"
</pre>


<h3> Up and SSh</h3>

<pre>
    $vagrant up

    Bringing machine 'default' up with 'virtualbox' provider...
    ==> default: Importing base box 'hashicorp/precise64'...
    ==> default: Matching MAC address for NAT networking...
    ==> default: Checking if box 'hashicorp/precise64' is up to date...
    ==> default: Setting the name of the VM: vagrant_default_1407584461236_45519
    ==> default: Clearing any previously set network interfaces...
    ==> default: Preparing network interfaces based on configuration...
        default: Adapter 1: nat
    ==> default: Forwarding ports...
        default: 22 => 2222 (adapter 1)
    ==> default: Booting VM...
    ==> default: Waiting for machine to boot. This may take a few minutes...
        default: SSH address: 127.0.0.1:2222
        default: SSH username: vagrant
        default: SSH auth method: private key
    ==> default: Machine booted and ready!
    ==> default: Checking for guest additions in VM...
        default: The guest additions on this VM do not match the installed version of
        default: VirtualBox! In most cases this is fine, but in rare cases it can
        default: prevent things such as shared folders from working properly. If you see
        default: shared folder errors, please make sure the guest additions within the
        default: virtual machine match the version of VirtualBox you have installed on
        default: your host and reload your VM.
        default: 
        default: Guest Additions Version: 4.2.0
        default: VirtualBox Version: 4.3
    ==> default: Mounting shared folders...
        default: /vagrant => /home/manuel/src/notempo/ntchef/vagrant

    $vagrant ssh
    Welcome to Ubuntu 12.04 LTS (GNU/Linux 3.2.0-23-generic x86_64)

     * Documentation:  https://help.ubuntu.com/
    Welcome to your Vagrant-built virtual machine.
    Last login: Fri Sep 14 06:23:18 2012 from 10.0.2.2
</pre>

<h3> Synced Folders</h3>

<p> You can tell vagrant which or your local folders do you want to by synchronized on your virtual machine. In this example we will setup the
local directory ~/src/django whre will be a simple django project. In order to setup this directory you have to stop your localbox with
<code>vagrant halt </code> and edit Vagrantfile . Find the option   config.vm.synced_folder and mofidy it, the first argument is where your
local directory is and the second where will be synchronized on the local box:
</p>

<pre>
      config.vm.synced_folder "~/src/django", "/vagrant_data"
</pre>

<h3>Provisioning </h3>

<p>
    Above the list of tools/frameworks/libraries that we need to install in order to setup a django dev box:
</p>

<ul>
    <li> Python</li>
    <li> Python virtual env with django framework and postgresql driver </li>
    <li> Postgresql db</li>
    <li> Supervisor</li>
</ul>




<h4>Django vagrant chef</h4>
<p> Chef is a systems and cloud infrastructure automation framework. You can find an introduction at this 
    <a href="http://www.maigfrga.ntweb.co/introduccion-chef-server/"> link.</a>. We will use chef to provisioning our virtualbox, so everytime
    that the machine starts, chef will be executed and if there is a change in the infraestructre, cheff will update our box automatically.
    </p>

<p> <a href="https://github.com/maigfrga/django-vagrant-chef"> Django vagrant chef </a> is a chef project that contains
 cookboks to  setup an ubuntu machine for django development with django/postgresql. 
<a href="https://github.com/maigfrga/django-vagrant-chef/blob/master/README.md"> You can find the documentation here </a>
</p>

<pre>
    $cd ~/src
    $git clone https://github.com/maigfrga/django-vagrant-chef.git

</pre>

<h5>Django vagrant chef Attributes</h5>

<p>Python attributes:</p>


<pre>
    ['python']['install_method'] = 'package'
    ['python']['venv_dir'] = '/svr/env/'
</pre>


<p>Postgresql attributes </p>
<pre>
    ['django_postgresql']['database'] = ''
    ['django_postgresql']['user'] = ''
    ['django_postgresql']['password'] = ''

</pre>

<p>Packages to be installed on the virtualenv</p>

<pre>
['django']['python']['packages'] = ["ipdb", "http2"]
</pre>

<p>Django app details</p>

<pre>
    ['django']['app']['project_home'] = '/vagrant_data/project'
    ['django']['app']['settings'] = 'project.settings'
    ['django']['app']['port'] = '8080'
</pre>

<p>Supervisor </p>

<pre>
    ['supervisor']['inet_username'] = ''
    ['supervisor']['inet_password'] = ''
</pre>

<h4> Configuring vagrant to use Django vagrant chef </h4>

<p>
    Install omnibus plugin that find chef dependencies
</p>

<pre>
  $vagrant plugin install vagrant-omnibus  
  $vagrant plugin install vagrant-librarian-chef
</pre>

<p>
    Edit Vagrantfile, setup the location of django-vagran-chef project, and tell vagrant which recipes should be executed:
</p>

<pre>
  config.omnibus.chef_version = :latest
  config.librarian_chef.cheffile_dir = '~/src/django-vagrant-chef'
  config.vm.provision "chef_solo" do |chef|
    chef.cookbooks_path = ["~/src/django-vagrant-chef/cookbooks", "~/src/django-vagrant-chef/site-cookbooks"]
    chef.roles_path = "~/src/django-vagrant-chef/roles"
    chef.data_bags_path = "~/src/django-vagrant-chef/data_bags"
    chef.add_role('django')
      chef.json = {
        "postgresql" => {
          "password" => {
            "postgres" => "iloverandompasswordsbutthiswilldo"
          }
        },
        "python" => {
            "install_method" => "package",
            "venv_dir" => "/svr/env/",
        },
        "django" => {
            "python" => {
                "packages" => ["ipdb", "http2"]
            },
            "app" => {
                "project_home" => "/vagrant_data/project",
                "settings" => "project.settings",
                "port" => "8080"

           }
        },
        "supervisor" => {
            "inet_username" => "manuel",
            "inet_password" => "manuel"
        }
      }
  end
</pre>

<h3> Networking</h3>

<p>
    We will setup a custom ip address for the vagrant box and fordwar the port 80 from our localhost to the port 8080 where the django 
    app is running at the vagrant box. <a href="http://docs.vagrantup.com/v2/networking/index.html"> All the docs about vagrant networking at this link</a>
</p>


<h4> Configuring a private network address</h4>

<pre>
    config.vm.network "private_network", ip: "192.168.33.10"
</pre>

<h3>Reloading box</h3>
<p>
    Every time that you start the vagrant box with <code>vagrant up </code> command, configuration changes are applied, if the vagrant box is already up
    you can reload configuration with <code> vagran reload --provision </code>
</p>


<p>
    <a href="https://github.com/maigfrga/blog/blob/master/2014/08/vagrant-django/Vagrantfile">At this link Vagrant file used in this guide </a>
</p>

<h3> References</h3>
<ul>
    <li> Vagrant's website: <a href="http://www.vagrantup.com/">http://www.vagrantup.com/ </a>  </li>
</ul>
