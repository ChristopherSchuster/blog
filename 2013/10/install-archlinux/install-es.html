Instalando Archlinux

<p>Las distribuciones modernas de Linux son faciles de instalar, casi todas traen un instalador que
permite a trav&eacute:s de un sencillo asistente instalar de forma rapida y sencilla el sistema operativo.
Es realmente ventajoso usar un asistente por practicidad pero existe el riesgo de olvidar o ignorar lo que
realmente pasa  por lo que se pierde control del sistema. Archlinux es una distribuci&oacute;n con un punto
de vista diferente que invita al usuario a aprender m&aacute;s sobre sus sistema. Esta entrada es el resumen
de mi experiencia personal instalando esta interesante distribuci&oacute;n. El tutorial completo puede ser 
encontrado en este enlace <a href="https://wiki.archlinux.org/index.php/Installation_Guide">de la 
documentaci&oacute;n oficial</a>.
</p>

<h3>Creando una usb con la imagen</h3>

<pre>
    sudo dd bs=4M if=/home/manuel/Downloads/archlinux-2013.10.01-dual.iso of=/dev/sdx && sync
</pre>

<h3>Cargando el layout del teclado</h3>
<pre>
    loadkeys us
    loadkeys es
</pre>


<h3>Configurando el disco duro</h3>
<h4>Particionando el disco duro</h4>
<p>
    El tutorial completo de particionado en 
    <a href="https://wiki.archlinux.org/index.php/Partitioning">este enlace</a>
</p>

<pre>
    check hard disk size
    fdisk -l | grep Disk

    /boot 300MB
    SWAP 2GB
    /var 22GB
    / 24 GB
    /home 280GB

    gdisk /dev/sda

    ? for help

    o to create a new empty GUID partition table
    n to add new partition
    i show info
    w write disk partition table

    lsblk to check all partitions

    https://wiki.archlinux.org/index.php/File_Systems#Step_2:_create_the_new_file_system

    mkfs -t ext2 /dev/sda1
    mkfs -t ext4 /dev/sda2
    mkfs -t ext4 /dev/sda3
    mkfs -t ext4 /dev/sda4
    mkswap /dev/sda5
</pre>

<h4>Encriptando el disco duro</h4>
<p>
    https://wiki.archlinux.org/index.php/Disk_Encryption

    https://wiki.archlinux.org/index.php/Dm-crypt_with_LUKS
</p>

<h5>Borrado seguro del disco duro antes de encriptar</h5>

<p>https://wiki.archlinux.org/index.php/Securely_wipe_disk</p>
<pre>
dd if=/dev/zero of=/dev/sdX iflag=nocache oflag=direct bs=4096
</pre>

<h5>Encriptando y mapeando particiones</h5>
<p>
https://wiki.archlinux.org/index.php/Dm-crypt_with_LUKS#Encrypting_a_system_partition
</p>

<pre>
cryptsetup --cipher aes-xts-plain64 --key-size 512 --hash sha512 --iter-time 5000 --use-random --verify-passphrase luksFormat /dev/sda2
cryptsetup --cipher aes-xts-plain64 --key-size 512 --hash sha512 --iter-time 5000 --use-random --verify-passphrase luksFormat /dev/sda3
cryptsetup --cipher aes-xts-plain64 --key-size 512 --hash sha512 --iter-time 5000 --use-random --verify-passphrase luksFormat /dev/sda4
</pre>

<h5>Abriendo las particiones encriptadas: </h5>

<pre>
cryptsetup open --type luks /dev/sda2 root
cryptsetup open --type luks /dev/sda3 var
cryptsetup open --type luks /dev/sda4 home
</pre>

<h5>Formateando las particiones: </h5>

<pre>
mkfs -t ext4 /dev/mapper/root
mkfs -t ext4 /dev/mapper/var
mkfs -t ext4 /dev/mapper/home
</pre>

<h5>Mountando las Particiones</h5>

<pre>
mount -t ext4 /dev/mapper/root /mnt
mount -t ext4 /dev/mapper/var /mnt
mount -t ext4 /dev/mapper/home /mnt
</pre>

<p>
<strong>Nota:</strong> la particion /boot no puede ser encriptada.
</p>


<h5>Encriptando la particion swap</h5>
<p>Edit/etc/crypttab: </p>
<pre>
swap         /dev/hdx4        /dev/urandom            swap,cipher=aes-cbc-essiv:sha256,size=256
</pre>

<h5> Montando la particion /boot </h5>

<pre>
mkdir /mnt/boot
mount -t ext2 /dev/sda1 /mnt/boot
</pre>

<h4>Conectando provisionalmente a internet</h4>

<pre>
wifi-menu
</pre>

<h4>Instalando el sistema base</h4>

<p>Editar /etc/pacman.d/mirrorlist y configurar el mirror m&aacute;s cercano, luego ejecutar:</p>

<pre>
pacstrap /mnt base
</pre>

<h4>Generar el archivo fstab:</h4>
<pre>genfstab -p /mnt >> /mnt/etc/fstab</pre>

<h4>Instalar chroot</h4>

<pre>arch-chroot /mnt</pre>

<h4>Configurar hora y zona</h4>
<p>Crear un enlace simbolico de /etc/localtime a /usr/share/zoneinfo/Zone/SubZone. Reemplazar  Zone y Subzone 
por los valores requeridos. </p>

<pre>ln -s /usr/share/zoneinfo/Europe/Dublin /etc/localtime</pre>

<p>
Descomentar timezone seleccionado en /etc/locale.gen y ejecutar <code>locale-gen</code>, editar preferencias en
<code>/etc/locale.conf</code>. https://wiki.archlinux.org/index.php/Locale#Setting_system-wide_locale
</p>

<h4>Configurar initramfs</h4>
<p>
Editar /etc/mkinitcpio.conf and descomentar la siguiente l&iacute;nea:

HOOKS="base udev ... encrypt ... filesystems ..."

Luego ejecutar  <code>mkinitcpio -p linux</code>
</p>

<h4>Configurar wifi</h4>
<h5>Instalar iw tool</h5>
<pre>
pacman -S iw
</pre>

<h5>Buscar puntos de acceso disponibles:</h5>
 
<pre>
iw dev wlan0 scan | less
</pre>

<h5>install wpa_supplicant:</h5>
<pre>
pacman -S wpa_supplicant
</pre>

<p>Informaci&oacute;n detallada en https://wiki.archlinux.org/index.php/Wireless_Setup </p>

<h4>Instalar y configurar Syslinux boot loader</h4>

<pre>
    pacman -S syslinux
    pacman -S gptfdisk
    syslinux-install_update -i -a -m

    /boot/syslinux/syslinux.cfg

     PROMPT 1
     TIMEOUT 50
     DEFAULT arch
     
     LABEL arch
             LINUX ../vmlinuz-linux
             APPEND root=/dev/sda2 rw
             INITRD ../initramfs-linux.img
     
     LABEL archfallback
             LINUX ../vmlinuz-linux
             APPEND root=/dev/sda2 rw
             INITRD ../initramfs-linux-fallback.img

</pre>

<h4>Instalar video driver </h4>

<p>Verificar el chipset <code>lspci | grep VGA</code> e instalar en controlador apropiado,
en este ejemplo un controlador intel
<code>pacman -S xf86-video-intel</code></p>


<h4>Instalar network manager</h4>
<p>https://wiki.archlinux.org/index.php/NetworkManager

<code>pacman -S  networkmanager</code>
</p>

<h4>Instalar Gnome and login grafico</h4>
<p>https://wiki.archlinux.org/index.php/GNOME</p>
<pre>
pacman -S gnome gnome-extra network-manager-applet
pacman -S gstreamer
pacman -S --force gst-libav
pacman -S vlc
pacman -S flashplugin
pacman -S ttf-dejavu
</pre>

<h4>Librer&iacute:as b&aacute;sicas de desarrollo</h4>
<pre>
pacman -S linux-headers
pacman -S gcc make automake
</pre>

<h4>Creando un usuario y configurando sudo</h4>
<pre>
useradd -m -g users -s /bin/bash manuel
pacman -S sudo
</pre>

<p>Editar archivo config con el comando  <code>visudo</code>

y agregar informaci&oacute; relevante:</p>

<pre>manuel ALL=(ALL) ALL</pre>
